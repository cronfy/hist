# Как вести блог в формате git?

Нужно подумать, что нужно учесть при ведении блога в формате репозитория git. 

Итак.

Основные моменты понятны - берешь да ведёшь. Есть github.io для публикации. Есть Jekyll и аналоги.

## Структурирование информации и изменения структуры (редиректы)

Вопрос в структурировании информации и постоянных ссылках на неё. Если контент будет добавляться, то рано или 
поздно его захочется структурировать. Плоский список по дате создания неудобен, так как не решает задачу поиска
нужной информации, когда вспомнил "я что-то такое писал об X, дай-ка посмотрю".

Соответственно, нужна иерархическая структура контента, не важно суть сейчас какая, главное, что она будет.

Однако рано или поздно любая структура перестает нравиться и хочется её кардинально изменить.

И в такой момент я не хочу вспоминать, в каких местах я оставлял ссылки на контент и могу ли я ими пожертвовать? Или я должен там отредактировать ссылку? Или нужно сделать редирект? Или придется оставить
старую? Я не хочу после этого махать рукой "ай, ладно, проще в старой структуре все хранить".
Я хочу просто поменять структуру как мне удобно, не беспокоясь о том, что какие-то ссылки
побьются. Хочу, чтобы изменение структуры происходило Без, Проб, Лем.

Когда-нибудь мне может быть также захочется поменять структуру внешних URL. Ну мало ли. Или я буду
вынужден сделать это по каким-то причинам. Соответственно, это не должно вызывать 
сложности - составил линковку старых ссылок на новые, сделал редиректы и вперед. (Сам процесс составления
линковки не должен вызывать сложности).

Я думаю, решить эту проблему можно таким способом расположения контента:

 * content/ - здесь хранится контент (не публикуется, только хранится). Содержит контент в любой структуре, в которой удобно. Ссылок сюда не даём. Это такой раздел с исходником информации. 
   * Любая Структура
   * В которой Сейчас
   * Удобно
      * Пост 1
        * content.md 
        * .metadata
   * Хранить контент
      * Пост 2
 * public/ - здесь публикуется контент
   * v1/ - первая версия структуры внешних URL (любая структура внешних URL)
     * post1/
       * index.html
       * .metadata
     * post2/  
     * ...  
   * v2/ - вторая версия структуры внешних URL (любая другая структура внешних URL)
     * blog/2021-03-06-how-to-blog-in-git.html
     * programming/2021-02-18-phpstorm-is-cool.html
     * ...  
   * v...
    
Изначально делаем public/v1/, и в ней размещаем посты методом копирования контента из content/. 
Оставляем мета-данные - из каких недр content'а нужно брать информацию сюда. В принципе, руками
ничего копировать не надо - задачу решает автоматический генератор.

Ссылки так и будут выглядеть: myblog.example.com/v1/... . Наверное, это единственный неприятный сайд-эффект от такой схемы. Но вместо v1, v2... можно писать что-нибудь веселенькое.

Если мы решили поменять структуру внешних ссылок public/, то создаем новую папку 
public/v2/, настраиваем для неё генератор, чтобы публиковал посты по новой
структуре, генерируем посты. После этого с предыдущей версии public/v1/ можно сделать редиректы
на новую. Так как и в прежней и в новой версии public/ мы имеем ссылки на один 
и тот же content/, это будет несложно сделать.

И тут важно отметить, что ссылкой, которую мы можем редиректить, может быть только html-файл
(в связи с ограничениями github.io). А например, если у поста есть ресурс в виде приаттаченного 
doc-файла, то редирект для него сделать не получится. Так что, чтобы все упростить, 
ограничим наше стремление сохранять ссылки при перемещении только для постов (и договоримся,
что если размещаем где-то ссылку на блог, то это должна быть ссылка именно на пост, а не на
ресурс этого поста).

Со сменой URL понятно, теперь про смену структуры контента. Тут тоже несложно.

Если мы решили поменять структуру content/ - сохраняем у каждого контента метаданные, где он 
лежит сейчас, перераспределяем все по новым папкам, составляем карту линковки старое -> новое,
проходимся по метаданным public/v.../, перебиваем старую линковку (это которая в метаданных) 
на content/ на новую.

Вот. Как-то так. Кто-то скажет: избыточность, а я скажу: зато гибко.

## Комментарии в тексте

В тексте поста время от времени возникает желание сделать комментарий. Исходный формат статьи Markdown.

Вопрос: как оставлять комментарии в Markdown?

При этом речь не идет о каком-то супер-секретном комментарии. В любом случае репозиторий блога публичный.
Даже если комментария не будет в срендеренном HTML, его легко можно посмотреть в исходнике на github.
Цель только в том, чтобы оставить коммент (навроде todo), который не будет мешать читать пост.

В спецификации Markdown комментариев нет. 

Ответ есть в [этой статье на SO](https://stackoverflow.com/questions/4823468/comments-in-markdown).

Там предложено много вариантов, поэтому здесь будет список способов, которые я реально буду
использовать, и на этой же странице можно будет протестировать совместимость при смене движка 
Markdown, например.

В статье есть больше вариантов (например, вариант,
[подходящий для использования внутри списков github](https://stackoverflow.com/a/29724376)).

### Тест варианта HTML

Код (третий дефис не понял зачем, но говорят, что надо):

```markdown
<!---
строка 1

строка 2
-->
```

Тест (ничего не должно вывестись):

<!--
строка 1

строка 2
-->

### Тест варианта URL

Код:

```markdown
[//]: # (Тут текст комментария)
[//]: # (Многострочность через повторение)
[//]: # (Перед и после комментария нужна пустая строка)
```

Тест (ничего не должно вывестись):
 
[//]: # (Тут текст комментария)
[//]: # (Многострочность через повторение)
[//]: # (Перед и после комментария нужна пустая строка)


--- 

Ну, вроде работает.

## Редиректы на github.io

Как ты сделаешь редирект в условиях github.io?

Например, [созданием index.html с meta refresh](https://gist.github.com/domenic/1f286d415559b56d725bee51a62c24a7).  

Из чего следует, что все страницы, которые ты потенциально можешь захотеть редиректнуть,
должны быть `*.html`.

## Редакторы для Markdown

 * PHPStorm - хорошо, но баги, может поправят.
 * ReText - не совсем как на github, [чтобы поменять flavor нужно ставить pip'ом расширения](https://github.com/retext-project/retext/issues/369)... брр. 
 * Atom - глючит, падает, вместо preview выводит странные эксепшены.
 * Sublime + MarkdownPreview - как-то тоже не очень.. результат приходится смотреть в браузере. Зато рендерит самим github'ом это в целом неплохо.
 * Ghosttext пока не пробовал, инфа [тут](https://ru.stackoverflow.com/questions/549184/%D0%9A%D0%B0%D0%BA-%D0%B2-sublime-text-%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C-live-preview-%D1%80%D0%B0%D0%B7%D0%BC%D0%B5%D1%82%D0%BA%D0%B8-markdown).  
 
